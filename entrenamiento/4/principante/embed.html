

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>34. Usando starzel.votable_behavior en ploneconf.site &mdash; documentación de Maestría en Plone 4 - 1.2.5a</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="author" title="Sobre este documento"
              href="about.html"/>
    <link rel="top" title="documentación de Maestría en Plone 4 - 1.2.5a" href="index.html"/>
        <link rel="next" title="35. Buildout - Parte II: Cómo prepararse para el despliegue" href="deployment_sites.html"/>
        <link rel="prev" title="33. Haciendo nuestro paquete reusable" href="reusable.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Maestría en Plone 4
          

          
          </a>

          
            
            
              <div class="version">
                1.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">Sobre &#8220;Maestría en Plone&#8221;</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Instalación y configuración</a></li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Instalando Plone para el entrenamiento</a></li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">4. La Anatomía de Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="case.html">5. El caso de estudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. Las características de Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configurando y personalizando Plone a través de la Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extendiendo Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extiende Plone con paquetes Complementos</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Temas</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">11. Dexterity - Parte I: A través de la Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">12. Buildout - Parte I</a></li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">13. Creando complementos para personalizar Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views - Parte I</a></li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Personalizar plantillas existentes</a></li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views - Parte II: Una vista por defecto para la &#8220;charla&#8221;</a></li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views - Parte III: Una lista de Charlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="behaviors1.html">19. Comportamientos</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_1.html">20. Escribiendo Viewlets</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">21. Programando en Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="ide.html">22. IDEs y editores</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_2.html">23. Tipos Dexterity - Parte II: Creciendo</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_search.html">24. Búsqueda personalizada</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">25. Convertir las charlas en eventos</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_generated_content.html">26. Usar contenido generado</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">27. Recursos</a></li>
<li class="toctree-l1"><a class="reference internal" href="thirdparty_behaviors.html">28. Usando comportamientos de complementos de terceros</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexterity_3.html">29. Tipos Dexterity - III: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="eggs2.html">30. Creando paquetes reusables con Eggs</a></li>
<li class="toctree-l1"><a class="reference internal" href="behaviors2.html">31. Más comportamientos complejos</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewlets_2.html">32. Un viewlet para el comportamiento voteable</a></li>
<li class="toctree-l1"><a class="reference internal" href="reusable.html">33. Haciendo nuestro paquete reusable</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">34. Usando starzel.votable_behavior en ploneconf.site</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_sites.html">35. Buildout - Parte II: Cómo prepararse para el despliegue</a></li>
<li class="toctree-l1"><a class="reference internal" href="future_of_plone.html">36. El futuro de Plone</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional.html">37. Opcional</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGES.html">Cambios</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Mapa de ruta</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Maestría en Plone 4</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>34. Usando starzel.votable_behavior en ploneconf.site</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-starzel-votable-behavior-in-ploneconf-site">
<h1>34. Usando starzel.votable_behavior en ploneconf.site<a class="headerlink" href="#using-starzel-votable-behavior-in-ploneconf-site" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li><p class="first">Queremos usar el comportamiento de votación, para que nuestros usuarios revisores puedan votar.</p>
</li>
<li><p class="first">Para mostrar cómo usar los eventos, vamos a publicar automáticamente los tipos de contenidos talks que han alcanzado una cierta puntuación.</p>
</li>
<li><p class="first">No vamos a dejar que todos voten todo.</p>
</li>
</ul>
<p>Primero, debemos agregar nuestro paquete como una dependencia al paquete ploneconf.site.</p>
<p>Hacemos esto en dos lugares. La descripción del paquete egg en el archivo <code class="file docutils literal"><span class="pre">setup.py</span></code> necesita <code class="samp docutils literal"><span class="pre">starzel.votable_behavior</span></code> como una dependencia. De lo contrario ningún código fuente estará disponible.</p>
<p>La configuración persistente necesita ser instalada cuando instalamos nuestro sitio. Esto se configura en GenericSetup.</p>
<p>Comenzamos con la edición del archivo <code class="file docutils literal"><span class="pre">setup.py</span></code></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
    <span class="s1">&#39;setuptools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;plone.app.dexterity [relations]&#39;</span><span class="p">,</span>
    <span class="s1">&#39;plone.app.relationfield&#39;</span><span class="p">,</span>
    <span class="s1">&#39;plone.namedfile [blobs]&#39;</span><span class="p">,</span>
<span class="hll">    <span class="s1">&#39;starzel.votable_behavior&#39;</span><span class="p">,</span>
</span>    <span class="c1"># -*- Extra requirements: -*-</span>
<span class="p">],</span>
<span class="o">...</span>
</pre></div>
</td></tr></table></div>
<p>A continuación modificamos el archivo <code class="file docutils literal"><span class="pre">profiles/default/metadata.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;metadata&gt;</span>
  <span class="nt">&lt;version&gt;</span>1002<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>profile-plone.app.dexterity:default<span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>profile-plone.app.relationfield:default<span class="nt">&lt;/dependency&gt;</span>
<span class="hll">      <span class="nt">&lt;dependency&gt;</span>profile-starzel.votable_behavior:default<span class="nt">&lt;/dependency&gt;</span>
</span>    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/metadata&gt;</span>
</pre></div>
</td></tr></table></div>
<p>... only:: not presentation</p>
<blockquote>
<div><p>Qué nombre tan raro. profile- es un prefijo que siempre necesitarás hoy en día. Luego viene el nombre del paquete egg, y la parte después de los dos puntos es el nombre del perfil. El nombre del perfil se define en configuraciones zcml. Hasta ahora he tropezado sólo sobre un paquete donde el nombre del directorio de perfil era diferente al nombre GenericSetup Profile.</p>
<p>Ahora el paquete está allí, pero nada es votable. Esto se debe a que ningún tipo de contenido declara utilizar este comportamiento. Podemos añadir este comportamiento a través del panel de control, exportar la configuración y almacenarla en nuestro paquete egg. Vamos a añadirlo a mano ahora.</p>
</div></blockquote>
<p>Tenemos que agregar el comportamiento al tipo de contenidos talks, haremos esto en el archivo <code class="file docutils literal"><span class="pre">profiles/default/types/talk.xml</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Administrando las dependencias en el archivo metadata.xml es una buena práctica. No podemos confiar en recordar lo que tendríamos que hacer a mano. Por ejemplo, ¿recuerdas que tuvimos que añadir para seleccionar <code class="docutils literal"><span class="pre">Tipos</span> <span class="pre">predeterminados</span> <span class="pre">de</span> <span class="pre">Plone</span> <span class="pre">basados</span> <span class="pre">en</span> <span class="pre">Dexterity</span></code> al crear un nuevo sitio de Plone?</p>
<p class="last">En lugar de eso, debemos agregar <code class="docutils literal"><span class="pre">&lt;dependency&gt;profile-plone.app.contenttypes:plone-content&lt;/dependency&gt;</span></code> como la <a class="reference external" href="http://docs.plone.org/4/en/external/plone.app.contenttypes/docs/README.html#installation-as-a-dependency-from-another-product">documentación de plone.app.contenttypes</a> recomienda.</p>
</div>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.dexterity.behaviors.metadata.IDublinCore&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.content.interfaces.INameFromTitle&quot;</span><span class="nt">/&gt;</span>
<span class="hll">  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;starzel.votable_behavior.interfaces.IVoting&quot;</span><span class="nt">/&gt;</span>
</span><span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
<p>... only:: not presentation</p>
<blockquote>
<div><p>Ahora nosotros puede reinstalar nuestro sitio Plone.</p>
<p>Todo el mundo puede votar ahora en las charlas. Eso no es lo que queríamos. En realidad, sólo queremos que los revisores voten en las charlas pendientes. Esto significa que, dependiendo del estado del flujo de trabajo, el permiso tiene que cambiar. Por suerte, los flujos de trabajo se pueden configurar para hacer precisamente eso. Las charlas ya tienen su propio flujo de trabajo. Así que no interferiremos con otros paquetes.</p>
<p>En primer lugar, tenemos que decirle al flujo de trabajo que gestionará más permisos. A continuación, tenemos que configurar para cada estado, que el rol de usuario tiene ahora los dos nuevos permisos.</p>
<p>Esa es una configuración muy detallada, tal vez usted quiere hacerlo en la interfaz web y exportar la configuración. Por otro lado, es fácil cometer un simple error en ambos sentidos. Yo acabo de presentar la forma xml aquí.</p>
</div></blockquote>
<p>La configuración del flujo de trabajo está en el archivo <code class="file docutils literal"><span class="pre">profiles/default/workfows/talks_workflow.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;dc-workflow</span> <span class="na">workflow_id=</span><span class="s">&quot;talks_workflow&quot;</span> <span class="na">title=</span><span class="s">&quot;Talks Workflow&quot;</span> <span class="na">description=</span><span class="s">&quot; - Simple workflow that is useful for basic web sites. - Things start out as private, and can either be submitted for review, or published directly. - The creator of a content item can edit the item even after it is published.&quot;</span> <span class="na">state_variable=</span><span class="s">&quot;review_state&quot;</span> <span class="na">initial_state=</span><span class="s">&quot;private&quot;</span> <span class="na">manager_bypass=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;permission&gt;</span>Access contents information<span class="nt">&lt;/permission&gt;</span>
 <span class="nt">&lt;permission&gt;</span>Change portal events<span class="nt">&lt;/permission&gt;</span>
 <span class="nt">&lt;permission&gt;</span>Modify portal content<span class="nt">&lt;/permission&gt;</span>
 <span class="nt">&lt;permission&gt;</span>View<span class="nt">&lt;/permission&gt;</span>
<span class="hll"> <span class="nt">&lt;permission&gt;</span>starzel.votable_behavior: View Vote<span class="nt">&lt;/permission&gt;</span>
</span><span class="hll"> <span class="nt">&lt;permission&gt;</span>starzel.votable_behavior: Do Vote<span class="nt">&lt;/permission&gt;</span>
</span> <span class="nt">&lt;state</span> <span class="na">state_id=</span><span class="s">&quot;pending&quot;</span> <span class="na">title=</span><span class="s">&quot;Pending review&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>Waiting to be reviewed, not editable by the owner.<span class="nt">&lt;/description&gt;</span>
  ...
<span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Reviewer<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span><span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Reviewer<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span>  ...
 <span class="nt">&lt;/state&gt;</span>
 <span class="nt">&lt;state</span> <span class="na">state_id=</span><span class="s">&quot;private&quot;</span> <span class="na">title=</span><span class="s">&quot;Private&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>Can only be seen and edited by the owner.<span class="nt">&lt;/description&gt;</span>
  ...
<span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span><span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span>  ...
 <span class="nt">&lt;/state&gt;</span>
 <span class="nt">&lt;state</span> <span class="na">state_id=</span><span class="s">&quot;published&quot;</span> <span class="na">title=</span><span class="s">&quot;Published&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;description&gt;</span>Visible to everyone, editable by the owner.<span class="nt">&lt;/description&gt;</span>
  ...
<span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: View Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Site Administrator<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">   <span class="nt">&lt;permission-role&gt;</span>Manager<span class="nt">&lt;/permission-role&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span><span class="hll">  <span class="nt">&lt;permission-map</span> <span class="na">name=</span><span class="s">&quot;starzel.votable_behavior: Do Vote&quot;</span> <span class="na">acquired=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/permission-map&gt;</span>
</span>  ...
 <span class="nt">&lt;/state&gt;</span>
  ...
<span class="nt">&lt;/dc-workflow&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Tenemos que volver a instalar nuestro producto de nuevo.</p>
<p>Pero esta vez, esto no es suficiente. Los permisos se actualizan en los cambios de flujo de trabajo. Mientras no ocurra un cambio en el flujo de trabajo, las charlas tienen los mismos permisos que nunca.</p>
<p>Afortunadamente, hay un botón para eso en la vista Flujo de trabajo ZMI <span class="guilabel">Actualizar configuración de seguridad</span>.</p>
<p>Después de hacer clic en esto, sólo los usuarios administradores y los usuarios revisores pueden ver la funcionalidad de votación.</p>
<p>Por último, añadimos nuestra tonta función para autorizar los tipos de contenidos talks.</p>
<p>Rápidamente terminas escribiendo muchos manejadores de eventos, por lo que ponemos todo en un directorio para eventhandlers.</p>
<p>Para los eventos nosotros necesitamos un directorio <code class="file docutils literal"><span class="pre">events</span></code>.</p>
<p>Crear el directorio <code class="file docutils literal"><span class="pre">events</span></code> y agregar un archivo vació <code class="file docutils literal"><span class="pre">events/__init__.py</span></code>.</p>
<p>Lo próximo, registramos el directorio events en el archivo <code class="file docutils literal"><span class="pre">configure.zcml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;include</span> <span class="na">package=</span><span class="s">&quot;.events&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>entonces, escribimos la configuración ZCML para los eventos dentro del archivo <code class="file docutils literal"><span class="pre">events/configure.zcml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;subscriber</span>
    <span class="na">for=</span><span class="s">&quot;starzel.votable_behavior.interfaces.IVotable</span>
<span class="s">         zope.lifecycleevent.IObjectModifiedEvent&quot;</span>
    <span class="na">handler=</span><span class="s">&quot;.votable.votable_update&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Esto parece un MultiAdapter. Queremos ser notificados cuando un objeto IVotable se modifica. Nuestro método recibirá el objeto votable, y el evento en sí.</p>
<p>Y finalmente, nuestro manipulador del evento en el archivo <code class="file docutils literal"><span class="pre">events/votable.py</span></code></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plone.api.content</span> <span class="kn">import</span> <span class="n">transition</span>
<span class="kn">from</span> <span class="nn">plone.api.content</span> <span class="kn">import</span> <span class="n">get_state</span>
<span class="kn">from</span> <span class="nn">starzel.votable_behavior.interfaces</span> <span class="kn">import</span> <span class="n">IVoting</span>


<span class="k">def</span> <span class="nf">votable_update</span><span class="p">(</span><span class="n">votable_object</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="n">votable</span> <span class="o">=</span> <span class="n">IVoting</span><span class="p">(</span><span class="n">votable_object</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_state</span><span class="p">(</span><span class="n">votable_object</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;pending&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">votable</span><span class="o">.</span><span class="n">average_vote</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">transition</span><span class="p">(</span><span class="n">votable_object</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="s1">&#39;publish&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Estamos usando un montón de plone api aquí. Plone API hace el código una brisa fresca. Además, no hay nada realmente interesante. Sólo haremos algo, si el estado de flujo de trabajo está pendiente y el voto promedio es superior a 0,5. Como puede ver, el método <code class="samp docutils literal"><span class="pre">transition</span></code> no quiere el estado de destino, sino la transición para mover el estado al estado de destino.</p>
<p>No hay nada especial en marcha.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deployment_sites.html" class="btn btn-neutral float-right" title="35. Buildout - Parte II: Cómo prepararse para el despliegue" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reusable.html" class="btn btn-neutral" title="33. Haciendo nuestro paquete reusable" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright El texto y las ilustraciones en este sitio Web esta licenciadas por la Plone Foundation bajo la licencia Creative Commons Attribution 4.0 International.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.5a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>


</body>
</html>