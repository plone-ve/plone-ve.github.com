

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tipos Dexterity - Parte II: Creciendo &mdash; Maestría en Plone, un entrenamiento para principiantes - 1.2.5a</title>
  

  
  
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/custom.css" type="text/css" />
  
        <link rel="author" title="Sobre este documento"
              href="about.html"/>
    <link rel="top" title="documentación de Maestría en Plone - 1.2.5a" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Maestría en Plone</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">Sobre &#8220;Maestría en Plone&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#upcoming-trainings">Próximos entrenamientos</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#previous-trainings">Entrenamientos previos</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#trainers">Entrenadores</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#using-the-documentation-for-a-training">Usando la documentación para un entrenamiento</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#contributing">Contribuyendo</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#license">Licencia</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introducción</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-you">¿Quien eres tu?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-do">¿Qué haremos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-not-do">¿Qué no haremos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-to-expect">¿Qué esperar?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#documentation">Documentación</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#further-reading">Lecturas recomendadas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Instalación y configuración</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-plone">Instalando Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hosting-plone">Alojando Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#production-deployment">Despliegue en ambientes de producción</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Instalando Plone para el entrenamiento</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#installing-plone-without-vagrant">Instalando Plone sin Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-virtualbox">Instalar VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-and-configure-vagrant">Instalar y configurar Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#what-vagrant-does">¿Qué hace Vagrant?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">4. La Anatomía de Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope2">Zope2</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#content-management-framework">Content Management Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-toolkit-zope3">Zope Toolkit / Zope3</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-component-architecture-zca">Zope Component Architecture (ZCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#pyramid">Pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case.html">5. El caso de estudio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="case.html#background">Detalle</a></li>
<li class="toctree-l2"><a class="reference internal" href="case.html#requirements">Requerimientos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. Las características de Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#starting-and-stopping-plone">Iniciando y Deteniendo Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#users">Usuarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#configure-a-mailserver">Configurar un servidor de correo</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#walkthrough-of-the-ui">Tutorial de la interfaz de usuario</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-types">Tipos de Contenidos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#folders">Carpetas</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#collections">Colecciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-rules">Reglas de Contenido</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#history">Histórico</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#manage-members-and-groups">Administrar usuarios y grupos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#workflows">Flujos de trabajos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#working-copy">Copia de trabajo</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#placeful-workflows">Flujos de trabajo Placeful</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configurando y personalizando Plone a través de la Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#the-control-panel">El panel de control</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#portlets">Portlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#viewlets">Viewlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#zmi">ZMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#summary">Resumen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extendiendo Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-technologies">Tecnologías de extensión</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#what-are-components-what-is-zcml">¿Cuáles son los componentes?, ¿Que es el ZCML?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extiende Plone con paquetes Complementos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addons.html#how-to-find-add-ons">¿Como buscar complementos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#some-notable-add-ons">Algunos complementos notables</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#installing-add-ons">Instalando complementos</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#ploneformgen">PloneFormGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#add-photogallery-with-collective-plonetruegallery">Agregar Galerías de fotos con collective.plonetruegallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#internationalization">Internacionalización</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#summary">Resumen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Temas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theming.html#diazo-example">ejemplo Diazo</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#templating-example">ejemplo de Plantila</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#choosing-the-right-tool">Seleccionando la herramienta adecuada</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#want-to-really-learn-theming">¿Quieres aprender realmente tematización?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">11. Dexterity - Parte I: A través de la Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#what-is-a-content-type">¿Qué es un tipo de contenido?</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#the-makings-of-a-plone-content-type">Los elementos de un tipo de contenido Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#dexterity-and-archetypes-a-comparison">Dexterity y Archetypes - Una comparación</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#installation">Instalación</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#modifying-existing-types">Modificando tipos existentes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#creating-content-types-ttw">Creando tipos de contenidos a través de la Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#moving-content-types-into-code">Moviendo el tipo de contenido dentro del código fuente</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#exercises">Ejercicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">12. Buildout - Parte I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#syntax">Sintaxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#recipes">Recetas</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#references">Referencias</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#a-real-life-example">Un ejemplo de la vida real</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#hello-mr-developer">¡Hola mr.developer!</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#extensible">Extensible</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#be-mcguyver">Sea un McGuyver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">13. Creando complementos para personalizar Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#using-zopeskel-to-create-an-egg">Usando zopeskel para crear un paquete egg</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#inspecting-the-package">Inspeccione el paquete</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#including-the-egg-in-plone">Incluyendo el paquete egg en Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#return-to-dexterity-moving-content-types-into-code">Volver Dexterity: para mover tipos de contenidos a código fuente</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views - Parte I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_1.html#a-simple-browser-view">Una simple browser view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#tal-and-tales">TAL y TALES</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#metal-and-macros">METAL y macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#accessing-plone-from-the-template">Accediendo a Plone desde la plantilla</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#what-we-missed">Lo que echamos de menos</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#chameleon">Chameleon</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Personalizar plantillas existentes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#newsitem-pt">El archivo newsitem.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#summary-view-pt">El archivo summary_view.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#finding-the-right-template">Buscando la correcta plantilla</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#skin-templates">Plantillas skins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views - Parte II: Una vista por defecto para la &#8220;charla&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#view-classes">Vista de clases</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#the-default-view">La vista por defecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#exercise">Ejercicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views - Parte III: Una lista de Charlas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#using-portal-catalog">Usando portal_catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#brains-and-objects">Cerebros y objetos</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#querying-the-catalog">Consultando el catálogo</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#exercises">Ejercicios</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#the-template-for-the-listing">La plantilla para la lista</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#setting-a-custom-view-as-default-view-on-an-object">Configuración de una vista personalizada como vista por defecto en un objeto</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#adding-some-javascript-collective-js-datatables">Agregando un poco de Javascript (collective.js.datatables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#summary">Resumen</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGES.html">Registro de cambios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#unreleased">1.2.5 (unreleased)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id1">1.2.4 (2014-10-03)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id2">1.2.3 (2014-07-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id3">1.2.2 (2014-06-01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id4">1.2.1 (2014-05-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id5">1.2 (2014-05-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2013">1.1 (October 2013)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2012">1.0 (October, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2011">0.2 October 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2009">0.1 (October 2009)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Mapa de ruta</a><ul>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#id1">1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#todo">Todo</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Maestría en Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Tipos Dexterity - Parte II: Creciendo</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="dexterity-types-ii-growing-up">
<h1>Tipos Dexterity - Parte II: Creciendo<a class="headerlink" href="#dexterity-types-ii-growing-up" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">¡Obtén el código!</p>
<p>Obtén el código para este capitulo (<a class="reference internal" href="sneak.html"><em>Mas información</em></a>) usando este comando en el directorio buildout:</p>
<div class="last highlight-bash"><div class="highlight"><pre>cp -R src/ploneconf.site_sneak/chapters/23_dexterity_2/ src/ploneconf.site
</pre></div>
</div>
</div>
<p>Las talks existentes todavía faltan algunas funciones que queremos utilizar.</p>
<p>En esta parte vamos a:</p>
<ul class="simple">
<li><p class="first">añadir una interfaz de marcador para nuestro tipo de contenido talk</p>
</li>
<li><p class="first">crear catálogo de índices personalizados</p>
</li>
<li><p class="first">consultar el catálogo para ellos</p>
</li>
<li><p class="first">permitir a algunas características más por defecto para nuestro tipo de contenido</p>
</li>
</ul>
<div class="section" id="add-a-marker-interface-to-the-talk-type">
<h2>Agregar una interfaz de marcador para el tipo de contenido talk<a class="headerlink" href="#add-a-marker-interface-to-the-talk-type" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="marker-interfaces">
<h3>Marcador de interfaces<a class="headerlink" href="#marker-interfaces" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El tipo de contenido <cite>Talk</cite> no es aun ciudadano de primera clase porque no implementa su propia interfaz. interfaces son como etiquetas de nombre, diciendo a otros elementos quien y que eres y que puedes hacer. un marcador de interfaz es como una etiqueta. Las Talks actualmente tienen un marcador de interfaz auto generado <code class="docutils literal"><span class="pre">plone.dexterity.schema.generated.Plone_0_talk</span></code>.</p>
<p>El problema es que el nombre de la instancia <code class="docutils literal"><span class="pre">Plone</span></code> es parte del nombre de la interfaz. si tu ahora mueves estos tipos a un sitio con otro nombre, el código que usa en estas interfaces no podrán ser capaces de encontrar estos objetos.</p>
<p>Para solventar esto agregamos un nuevo archivo <code class="docutils literal"><span class="pre">interfaces.py</span></code>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>


<span class="k">class</span> <span class="nc">ITalk</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marker interface for Talks</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal"><span class="pre">ITalk</span></code> es una interfaz marcador. Podemos anexar Vistas y Viewlets a contenido que provee estas interfaces. Ahora veremos como proveer esta interfaz. Hay dos soluciones para esto.</p>
<ol class="arabic simple">
<li><p class="first">Dejemos que sean instancias de una clase que implementa esta interfaz.</p>
</li>
<li><p class="first">Registra esta interfaz como un comportamiento y habilitalo en el tipo de contenido talks.</p>
</li>
</ol>
<p>La primera opción tiene un inconveniente importante: Sólo nuevas talks pueden ser instancias de una nueva clase. Nos gustaría o podríamos tal vez tener que migrar a las talks existentes o eliminarlas.</p>
<p>Así que vamos a registrar la interfaz como un comportamiento en el archivo <code class="docutils literal"><span class="pre">behaviors/configure.zcml</span></code></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;plone:behavior</span>
  <span class="na">title=</span><span class="s">&quot;Talk&quot;</span>
  <span class="na">description=</span><span class="s">&quot;Marker interface for talks to be able to bind views to.&quot;</span>
  <span class="na">provides=</span><span class="s">&quot;..interfaces.ITalk&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Y habilitelo en la definición de tipo en el archivo <code class="docutils literal"><span class="pre">profiles/default/types/talk.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.dexterity.behaviors.metadata.IDublinCore&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;plone.app.content.interfaces.INameFromTitle&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;ploneconf.site.behaviors.social.ISocial&quot;</span><span class="nt">/&gt;</span>
<span class="hll"> <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;ploneconf.site.interfaces.ITalk&quot;</span><span class="nt">/&gt;</span>
</span><span class="nt">&lt;/property&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Either reinstall the addon, apply the behavior by hand or run a upgrade-step (see below) and the interface will be there.</p>
<p>Then we can safely bind the talkview to the new marker interface.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:page</span>
  <span class="na">name=</span><span class="s">&quot;talkview&quot;</span>
<span class="hll">  <span class="na">for=</span><span class="s">&quot;ploneconf.site.interfaces.ITalk&quot;</span>
</span>  <span class="na">layer=</span><span class="s">&quot;zope.interface.Interface&quot;</span>
  <span class="na">class=</span><span class="s">&quot;.views.TalkView&quot;</span>
  <span class="na">template=</span><span class="s">&quot;templates/talkview.pt&quot;</span>
  <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Now the <code class="docutils literal"><span class="pre">/talkview</span></code> can only be used on objects that implement said interface. We can now also query the catalog for objects providing this interface <code class="docutils literal"><span class="pre">catalog(object_provides=&quot;ploneconf.site.interfaces.ITalk&quot;)</span></code>. The <cite>talklistview</cite> and the <cite>demoview</cite> do not get this constraint since they are not only used on talks.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Just for completeness sake, this is what would have to happen for the first option:</p>
<ul class="last">
<li><p class="first">Create a new class that inherits from <code class="docutils literal"><span class="pre">plone.dexterity.content.Container</span></code> and implements the marker interface.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.dexterity.content</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">ploneconf.site.interfaces</span> <span class="kn">import</span> <span class="n">ITalk</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implements</span>

<span class="k">class</span> <span class="nc">Talk</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">ITalk</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Modificar la clase para la nueva talks en el archivo <code class="docutils literal"><span class="pre">profiles/default/types/talk.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>...
<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;add_permission&quot;</span><span class="nt">&gt;</span>cmf.AddPortalContent<span class="nt">&lt;/property&gt;</span>
<span class="hll"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;klass&quot;</span><span class="nt">&gt;</span>ploneconf.site.content.talk.Talk<span class="nt">&lt;/property&gt;</span>
</span><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;behaviors&quot;</span><span class="nt">&gt;</span>
...
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Crear un paso de actualización para modificar la clase de tipo de contenido existente. Un código ejemplo de como hacer esto lo encuentra en el paquete <a class="reference external" href="https://github.com/4teamwork/ftw.upgrade/blob/master/ftw/upgrade/step.py#L270">ftw.upgrade</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="upgrade-steps">
<h2>Pasos de actualización<a class="headerlink" href="#upgrade-steps" title="Enlazar permanentemente con este título">¶</a></h2>
<p>When projects evolve you&#8217;ll sometimes have to modify various things while the site is already up and brimming with content and users. Upgrade steps are pieces of code that run when upgrading from one version of a addon to a newer one. They can do just about anything.</p>
<p>Nosotros crearemos un paso de actualización que</p>
<ul class="simple">
<li>runs the typeinfo-step (i.e. loads the GenericSetup configuration stores in <code class="docutils literal"><span class="pre">profiles/default/types.xml</span></code> and <code class="docutils literal"><span class="pre">profiles/default/types/...</span></code> so we don&#8217;t have to reinstall the addon to have our changes from above take effect) and</li>
<li>cleans up some content that might be scattered around the site in the early stages of creating it. We will move all talks to a folder <code class="docutils literal"><span class="pre">talks</span></code> (unless they already are there).</li>
</ul>
<p>Los pasos de actualización son usualmente registrados en en su propio archivo zcml. Cree el archivo``upgrades.zcml``</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
  <span class="na">xmlns:i18n=</span><span class="s">&quot;http://namespaces.zope.org/i18n&quot;</span>
  <span class="na">xmlns:genericsetup=</span><span class="s">&quot;http://namespaces.zope.org/genericsetup&quot;</span>
  <span class="na">i18n_domain=</span><span class="s">&quot;ploneconf.site&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;genericsetup:upgradeStep</span>
    <span class="na">title=</span><span class="s">&quot;Update and cleanup talks&quot;</span>
    <span class="na">description=</span><span class="s">&quot;Updates typeinfo and moves talks to a folder &#39;talks&#39;&quot;</span>
    <span class="na">source=</span><span class="s">&quot;1&quot;</span>
    <span class="na">destination=</span><span class="s">&quot;1001&quot;</span>
    <span class="na">handler=</span><span class="s">&quot;ploneconf.site.upgrades.upgrade_site&quot;</span>
    <span class="na">sortkey=</span><span class="s">&quot;1&quot;</span>
    <span class="na">profile=</span><span class="s">&quot;ploneconf.site:default&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</td></tr></table></div>
<p>The upgrade step bumps the verion-number of the GenericSetup profile of ploneconf.site from 1 to 1001. The version is stored in <code class="docutils literal"><span class="pre">profiles/default/metadata.xml</span></code>. Change it to</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;version&gt;</span>1001<span class="nt">&lt;/version&gt;</span>
</pre></div>
</div>
<p>Incluir el nuevo archivo <code class="docutils literal"><span class="pre">upgrades.zcml</span></code> en nuestro archivo <code class="docutils literal"><span class="pre">configure.zcml</span></code> agregando:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;upgrades.zcml&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>GenericSetup now expects the code as a method <code class="docutils literal"><span class="pre">upgrade_site</span></code> in the file <code class="docutils literal"><span class="pre">upgrades.py</span></code>. Let&#8217;s create it.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">default_profile</span> <span class="o">=</span> <span class="s">&#39;profile-ploneconf.site:default&#39;</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;ploneconf.site&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">upgrade_site</span><span class="p">(</span><span class="n">setup</span><span class="p">):</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">runImportStepFromProfile</span><span class="p">(</span><span class="n">default_profile</span><span class="p">,</span> <span class="s">&#39;typeinfo&#39;</span><span class="p">)</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
    <span class="n">portal</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="s">&#39;the-event&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">portal</span><span class="p">:</span>
        <span class="n">theevent</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">portal</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s">&#39;Folder&#39;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s">&#39;the-event&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;The event&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">theevent</span> <span class="o">=</span> <span class="n">portal</span><span class="p">[</span><span class="s">&#39;the-event&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;talks&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">theevent</span><span class="p">:</span>
        <span class="n">talks</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">container</span><span class="o">=</span><span class="n">theevent</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s">&#39;Folder&#39;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s">&#39;talks&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Talks&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">talks</span> <span class="o">=</span> <span class="n">theevent</span><span class="p">[</span><span class="s">&#39;talks&#39;</span><span class="p">]</span>
    <span class="n">talks_url</span> <span class="o">=</span> <span class="n">talks</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">()</span>
    <span class="n">brains</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;talk&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">talks_url</span> <span class="ow">in</span> <span class="n">brain</span><span class="o">.</span><span class="n">getURL</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Moving </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">(),</span> <span class="n">talks</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">()))</span>
        <span class="n">api</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">talks</span><span class="p">,</span>
            <span class="n">safe_id</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>After restarting the site we can run the step:</p>
<ul class="simple">
<li>Go to the addon-controlpanel <a class="reference external" href="http://localhost:8080/Plone/prefs_install_products_form">http://localhost:8080/Plone/prefs_install_products_form</a>. There should now be a warning <strong>This add-on has been upgraded. Old profile version was 1. New profile version is 1001</strong> and a button next to it.</li>
<li><p class="first">Ejecutar el paso de actualización haciendo clic en el.</p>
</li>
</ul>
<p>En la consola debería ver mensajes de registro como este:</p>
<div class="highlight-python"><div class="highlight"><pre>INFO ploneconf.site Moving http://localhost:8080/Plone/old-talk1 to http://localhost:8080/Plone/the-event/talks
</pre></div>
</div>
<p>Alternatively you can select which upgrade-steps to run like this:</p>
<ul class="simple">
<li><p class="first">En la ZMI valla a la herramienta <em>portal_setup</em></p>
</li>
<li><p class="first">Valla a la pestaña <em>Upgrades</em></p>
</li>
<li><p class="first">Seleccione <em>ploneconf.site</em> desde la lista desplegable y haga clic <em>Choose profile</em></p>
</li>
<li><p class="first">Ejecutar el paso de actualización.</p>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/addons/components/genericsetup.html#id1">http://docs.plone.org/develop/addons/components/genericsetup.html#id1</a></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Upgrading from an older version of Plone to a newer one also runs upgrade steps from the package <code class="docutils literal"><span class="pre">plone.app.upgrade</span></code>. You should be able to upgrade a clean site from 2.5 to 5.0a2 with a click.</p>
<p class="last">Para un ejemplo ver el paso de actualización para Plone 5.0a1 <a class="reference external" href="https://github.com/plone/plone.app.upgrade/blob/master/plone/app/upgrade/v50/alphas.py#L23">https://github.com/plone/plone.app.upgrade/blob/master/plone/app/upgrade/v50/alphas.py#L23</a></p>
</div>
</div>
<div class="section" id="add-a-browserlayer">
<h2>Agregar una browserlayer<a class="headerlink" href="#add-a-browserlayer" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A browserlayer is another such marker-interface. Browserlayers allow us to easily enable and disable views and other site functionality based on installed add-ons and themes.</p>
<p>Since we want the features we write only to be available when ploneconf.site actually is installed we can bind them to a browserlayer.</p>
<p>En el archivo <code class="docutils literal"><span class="pre">interfaces.py</span></code> nosotros agregamos:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IPloneconfSiteLayer</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marker interface for the Browserlayer</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Nosotros registramos la browserlayer en GenericSetup en el archivo <code class="docutils literal"><span class="pre">profiles/default/browserlayer.xml</span></code></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;layers&gt;</span>
  <span class="nt">&lt;layer</span> <span class="na">name=</span><span class="s">&quot;ploneconf.site&quot;</span>
    <span class="na">interface=</span><span class="s">&quot;ploneconf.site.interfaces.IPloneconfSiteLayer&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/layers&gt;</span>
</pre></div>
</div>
<p>After reinstalling the addon we can bind the talkview, the demoview and the talklistview to our layer. Here is an example using the talkview.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:page</span>
  <span class="na">name=</span><span class="s">&quot;talklistview&quot;</span>
  <span class="na">for=</span><span class="s">&quot;ploneconf.site.interfaces.ITalk&quot;</span>
<span class="hll">  <span class="na">layer=</span><span class="s">&quot;..interfaces.IPloneconfSiteLayer&quot;</span>
</span>  <span class="na">class=</span><span class="s">&quot;.views.TalkListView&quot;</span>
  <span class="na">template=</span><span class="s">&quot;templates/talklistview.pt&quot;</span>
  <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Note the relative python-path <code class="docutils literal"><span class="pre">..interfaces.IPloneconfSiteLayer</span></code>. It is equivalent to the absolute path <code class="docutils literal"><span class="pre">ploneconf.site.interfaces.IPloneconfSiteLayer</span></code>.</p>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/views/layers.html">http://docs.plone.org/develop/plone/views/layers.html</a></p>
</div>
<div class="section" id="exercise">
<h3>Ejercicio<a class="headerlink" href="#exercise" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Do you need to bind the social-viewlet from chapter 20 to this new browser-layer?</p>
<div class="toggle admonition">
<p class="first admonition-title">Solución</p>
<p class="last">No, it would make no difference since the viewlet is already bound to the marker interface <code class="docutils literal"><span class="pre">ploneconf.site.behaviors.social.ISocial</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="add-catalog-indexes">
<h2>Add catalog-indexes<a class="headerlink" href="#add-catalog-indexes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>In the <cite>talklistview</cite> we had to wake up all objects to access some of their attributes. That is ok if we don&#8217;t have many objects and they are light dexterity-objects. If we had thousands of objects this might not be a good idea.</p>
<p>Instead of loading them all into memory we will use catalog-indexes to get the data we want to display.</p>
<p>Agregar un nuevo archivo <code class="docutils literal"><span class="pre">profiles/default/catalog.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;portal_catalog&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;type_of_talk&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;FieldIndex&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;indexed_attr</span> <span class="na">value=</span><span class="s">&quot;type_of_talk&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/index&gt;</span>
  <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;speaker&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;FieldIndex&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;indexed_attr</span> <span class="na">value=</span><span class="s">&quot;speaker&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/index&gt;</span>
  <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;audience&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;KeywordIndex&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;indexed_attr</span> <span class="na">value=</span><span class="s">&quot;audience&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/index&gt;</span>

  <span class="nt">&lt;column</span> <span class="na">value=</span><span class="s">&quot;audience&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;column</span> <span class="na">value=</span><span class="s">&quot;type_of_talk&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;column</span> <span class="na">value=</span><span class="s">&quot;speaker&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This adds new indexes for the three fields we want to show in the listing. Not that <em>audience</em> is a <code class="docutils literal"><span class="pre">KeywordIndex</span></code> because the field is multi-valued, but we want a separate index-entry for every value in on an object.</p>
<p>The <code class="docutils literal"><span class="pre">column</span> <span class="pre">..</span></code> entry allows us to display these values of these indexes in the tableview of collections.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Until Plone 4.3.2 adding indexes in catalog.xml was harmful because reinstalling the addon purged the indexes! See <a class="reference external" href="http://www.starzel.de/blog/a-reminder-about-catalog-indexes">http://www.starzel.de/blog/a-reminder-about-catalog-indexes</a>.</p>
<p class="last">To run additional custom code on (re-)installing an addon you should use a <a class="reference external" href="http://docs.plone.org/develop/addons/components/genericsetup.html#custom-installer-code-setuphandlers-py">setuphandler.py</a>.</p>
</div>
<ul class="simple">
<li><p class="first">Instalar de nuevo el complemento</p>
</li>
<li><p class="first">Valla a la URL <a class="reference external" href="http://localhost:8080/Plone/portal_catalog/manage_catalogIndexes">http://localhost:8080/Plone/portal_catalog/manage_catalogIndexes</a> para inspeccionar el ingreso de datos e inspeccionar los nuevos índices</p>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/searching_and_indexing/indexing.html">http://docs.plone.org/develop/plone/searching_and_indexing/indexing.html</a></p>
</div>
</div>
<div class="section" id="query-for-custom-indexes">
<h2>Query for custom indexes<a class="headerlink" href="#query-for-custom-indexes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The new indexes behave like the ones that plone has built in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">Products.CMFCore.utils</span> <span class="kn">import</span> <span class="n">getToolByName</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">catalog</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">catalog</span><span class="p">(</span><span class="n">type_of_talk</span><span class="o">=</span><span class="s">&#39;Keynote&#39;</span><span class="p">)</span>
<span class="go">[&lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b9a8&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b9a8&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">catalog</span><span class="p">(</span><span class="n">audience</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Advanced&#39;</span><span class="p">,</span> <span class="s">&#39;Professionals&#39;</span><span class="p">))</span>
<span class="go">[&lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b870&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b940&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x10737b9a8&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">type_of_talk</span><span class="o">=</span><span class="s">&#39;Keynote&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">brain</span><span class="o">.</span><span class="n">speaker</span>
<span class="go">u&#39;David Glick&#39;</span>
</pre></div>
</div>
<p>We now can use the new indexes to improve the talklistview so we don&#8217;t have to wake up the objects any more.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TalkListView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A list of talks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">talks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">portal_catalog</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
        <span class="n">current_path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getPhysicalPath</span><span class="p">())</span>

        <span class="n">brains</span> <span class="o">=</span> <span class="n">portal_catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&quot;talk&quot;</span><span class="p">,</span>
                                <span class="n">path</span><span class="o">=</span><span class="n">current_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">Title</span><span class="p">,</span>
                <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">Description</span><span class="p">,</span>
                <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">getURL</span><span class="p">(),</span>
                <span class="s">&#39;audience&#39;</span><span class="p">:</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">brain</span><span class="o">.</span><span class="n">audience</span> <span class="ow">or</span> <span class="p">[]),</span>
                <span class="s">&#39;type_of_talk&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">type_of_talk</span><span class="p">,</span>
                <span class="s">&#39;speaker&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span>
                <span class="s">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">UID</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</td></tr></table></div>
<p>The template does not need to be changed and the result did not change as well.</p>
</div>
<div class="section" id="add-collection-criteria">
<h2>Add collection criteria<a class="headerlink" href="#add-collection-criteria" title="Enlazar permanentemente con este título">¶</a></h2>
<p>To be able to search content in collections using the new indexes we would have to register them as criteria for the querystring-widget that collections use.</p>
<p>Agregar un nuevo archivo <code class="docutils literal"><span class="pre">profiles/default/registry.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;registry&gt;</span>
  <span class="nt">&lt;records</span> <span class="na">interface=</span><span class="s">&quot;plone.app.querystring.interfaces.IQueryField&quot;</span>
           <span class="na">prefix=</span><span class="s">&quot;plone.app.querystring.field.audience&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Audience<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>A custom speaker index<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;enabled&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;sortable&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;operations&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;element&gt;</span>plone.app.querystring.operation.string.is<span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;group&quot;</span><span class="nt">&gt;</span>Metadata<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/records&gt;</span>
  <span class="nt">&lt;records</span> <span class="na">interface=</span><span class="s">&quot;plone.app.querystring.interfaces.IQueryField&quot;</span>
           <span class="na">prefix=</span><span class="s">&quot;plone.app.querystring.field.type_of_talk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;title&quot;</span><span class="nt">&gt;</span>Type of Talk<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>A custom index<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;enabled&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;sortable&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;operations&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;element&gt;</span>plone.app.querystring.operation.string.is<span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">key=</span><span class="s">&quot;group&quot;</span><span class="nt">&gt;</span>Metadata<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/records&gt;</span>
<span class="nt">&lt;/registry&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/functionality/collections.html#add-new-collection-criteria-new-style-plone-app-collection-installed">http://docs.plone.org/develop/plone/functionality/collections.html#add-new-collection-criteria-new-style-plone-app-collection-installed</a></p>
</div>
</div>
<div class="section" id="add-more-features-through-generic-setup">
<h2>Add more features through generic-setup<a class="headerlink" href="#add-more-features-through-generic-setup" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Enable versioning and a diff-view for talks through GenericSetup.</p>
<p>Agregar nuevo archivo <code class="docutils literal"><span class="pre">profiles/default/repositorytool.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;repositorytool&gt;</span>
  <span class="nt">&lt;policymap&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;talk&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;policy</span> <span class="na">name=</span><span class="s">&quot;at_edit_autoversion&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;policy</span> <span class="na">name=</span><span class="s">&quot;version_on_revert&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/policymap&gt;</span>
<span class="nt">&lt;/repositorytool&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Agregar nuevo archivo <code class="docutils literal"><span class="pre">profiles/default/diff_tool.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object&gt;</span>
  <span class="nt">&lt;difftypes&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">portal_type=</span><span class="s">&quot;talk&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;any&quot;</span> <span class="na">difftype=</span><span class="s">&quot;Compound Diff for Dexterity types&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/difftypes&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The text and illustrations in this website are licensed by the Plone Foundation under a Creative Commons Attribution 4.0 International license.
      Actualizado por última vez en 09 de Marzo de 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.5a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/jquery.js"></script>
      <script type="text/javascript" src="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/underscore.js"></script>
      <script type="text/javascript" src="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/doctools.js"></script>
      <script type="text/javascript" src="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="https://raw.githubusercontent.com/plone-ve/plone-ve.github.com/master/entrenamiento/principante/_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>


</body>
</html>