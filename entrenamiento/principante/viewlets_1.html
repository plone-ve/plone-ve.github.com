

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Escribiendo Viewlets &mdash; Maestría en Plone, un entrenamiento para principiantes - 1.2.5a</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
        <link rel="author" title="Sobre este documento"
              href="about.html"/>
    <link rel="top" title="documentación de Maestría en Plone - 1.2.5a" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Maestría en Plone</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">Sobre &#8220;Maestría en Plone&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#upcoming-trainings">Próximos entrenamientos</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#previous-trainings">Entrenamientos previos</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#trainers">Entrenadores</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#using-the-documentation-for-a-training">Usando la documentación para un entrenamiento</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#contributing">Contribuyendo</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#license">Licencia</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introducción</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-you">¿Quien eres tu?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-do">¿Qué haremos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-not-do">¿Qué no haremos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-to-expect">¿Qué esperar?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#documentation">Documentación</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#further-reading">Lecturas recomendadas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Instalación y configuración</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-plone">Instalando Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hosting-plone">Alojando Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#production-deployment">Despliegue en ambientes de producción</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Instalando Plone para el entrenamiento</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#installing-plone-without-vagrant">Instalando Plone sin Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-virtualbox">Instalar VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-and-configure-vagrant">Instalar y configurar Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#what-vagrant-does">¿Qué hace Vagrant?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">4. La Anatomía de Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope2">Zope2</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#content-management-framework">Content Management Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-toolkit-zope3">Zope Toolkit / Zope3</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-component-architecture-zca">Zope Component Architecture (ZCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#pyramid">Pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case.html">5. El caso de estudio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="case.html#background">Detalle</a></li>
<li class="toctree-l2"><a class="reference internal" href="case.html#requirements">Requerimientos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. Las características de Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#starting-and-stopping-plone">Iniciando y Deteniendo Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#users">Usuarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#configure-a-mailserver">Configurar un servidor de correo</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#walkthrough-of-the-ui">Tutorial de la interfaz de usuario</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-types">Tipos de Contenidos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#folders">Carpetas</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#collections">Colecciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-rules">Reglas de Contenido</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#history">Histórico</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#manage-members-and-groups">Administrar usuarios y grupos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#workflows">Flujos de trabajos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#working-copy">Copia de trabajo</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#placeful-workflows">Flujos de trabajo Placeful</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configurando y personalizando Plone a través de la Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#the-control-panel">El panel de control</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#portlets">Portlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#viewlets">Viewlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#zmi">ZMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#summary">Resumen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extendiendo Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-technologies">Tecnologías de extensión</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#what-are-components-what-is-zcml">¿Cuáles son los componentes?, ¿Que es el ZCML?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extiende Plone con paquetes Complementos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addons.html#how-to-find-add-ons">¿Como buscar complementos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#some-notable-add-ons">Algunos complementos notables</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#installing-add-ons">Instalando complementos</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#ploneformgen">PloneFormGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#add-photogallery-with-collective-plonetruegallery">Agregar Galerías de fotos con collective.plonetruegallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#internationalization">Internacionalización</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#summary">Resumen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Temas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theming.html#diazo-example">ejemplo Diazo</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#templating-example">ejemplo de Plantila</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#choosing-the-right-tool">Seleccionando la herramienta adecuada</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#want-to-really-learn-theming">¿Quieres aprender realmente tematización?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">11. Dexterity - Parte I: A través de la Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#what-is-a-content-type">¿Qué es un tipo de contenido?</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#the-makings-of-a-plone-content-type">Los elementos de un tipo de contenido Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#dexterity-and-archetypes-a-comparison">Dexterity y Archetypes - Una comparación</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#installation">Instalación</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#modifying-existing-types">Modificando tipos existentes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#creating-content-types-ttw">Creando tipos de contenidos a través de la Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#moving-content-types-into-code">Moviendo el tipo de contenido dentro del código fuente</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#exercises">Ejercicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">12. Buildout - Parte I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#syntax">Sintaxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#recipes">Recetas</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#references">Referencias</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#a-real-life-example">Un ejemplo de la vida real</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#hello-mr-developer">¡Hola mr.developer!</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#extensible">Extensible</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#be-mcguyver">Sea un McGuyver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">13. Creando complementos para personalizar Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#using-zopeskel-to-create-an-egg">Usando zopeskel para crear un paquete egg</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#inspecting-the-package">Inspeccione el paquete</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#including-the-egg-in-plone">Incluyendo el paquete egg en Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#return-to-dexterity-moving-content-types-into-code">Volver Dexterity: para mover tipos de contenidos a código fuente</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views - Parte I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_1.html#a-simple-browser-view">Una simple browser view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#tal-and-tales">TAL y TALES</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#metal-and-macros">METAL y macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#accessing-plone-from-the-template">Accediendo a Plone desde la plantilla</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#what-we-missed">Lo que echamos de menos</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#chameleon">Chameleon</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Personalizar plantillas existentes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#newsitem-pt">El archivo newsitem.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#summary-view-pt">El archivo summary_view.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#finding-the-right-template">Buscando la correcta plantilla</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#skin-templates">Plantillas skins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views - Parte II: Una vista por defecto para la &#8220;charla&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#view-classes">Vista de clases</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#the-default-view">La vista por defecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#exercise">Ejercicio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_3.html">18. Views - Parte III: Una lista de Charlas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#using-portal-catalog">Usando portal_catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#brains-and-objects">Cerebros y objetos</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#querying-the-catalog">Consultando el catálogo</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#exercises">Ejercicios</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#the-template-for-the-listing">La plantilla para la lista</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#setting-a-custom-view-as-default-view-on-an-object">Configuración de una vista personalizada como vista por defecto en un objeto</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#adding-some-javascript-collective-js-datatables">Agregando un poco de Javascript (collective.js.datatables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_3.html#summary">Resumen</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGES.html">Registro de cambios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#unreleased">1.2.5 (unreleased)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id1">1.2.4 (2014-10-03)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id2">1.2.3 (2014-07-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id3">1.2.2 (2014-06-01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id4">1.2.1 (2014-05-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id5">1.2 (2014-05-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2013">1.1 (October 2013)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2012">1.0 (October, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2011">0.2 October 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2009">0.1 (October 2009)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Mapa de ruta</a><ul>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#id1">1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#todo">Todo</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Maestría en Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Escribiendo Viewlets</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="writing-viewlets">
<h1>Escribiendo Viewlets<a class="headerlink" href="#writing-viewlets" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">¡Obtén el código!</p>
<p>Obtén el código para este capitulo (<a class="reference internal" href="sneak.html"><em>Mas información</em></a>) usando este comando en el directorio buildout:</p>
<div class="last highlight-bash"><div class="highlight"><pre>cp -R src/ploneconf.site_sneak/chapters/20_viewlets_1/ src/ploneconf.site
</pre></div>
</div>
</div>
<div class="section" id="a-viewlet-for-the-social-behavior">
<h2>Un viewlet para el comportamiento social<a class="headerlink" href="#a-viewlet-for-the-social-behavior" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Un viewlet no es una vista, pero un fragmento de HTML y la lógica que se puede poner en varios lugares en el sitio. Estos lugares se llaman <code class="docutils literal"><span class="pre">viewletmanager</span></code>.</p>
<ul class="simple">
<li><p class="first">Inspeccione los viewlets existentes y gestionelos yendo a <a class="reference external" href="http://localhost:8080/Plone/&#64;&#64;manage-viewlets">http://localhost:8080/Plone/&#64;&#64;manage-viewlets</a>.</p>
</li>
<li><p class="first">Ya hemos personalizado un viewlet (archivo <code class="file docutils literal"><span class="pre">collophon.pt</span></code>). Ahora añadimos una nueva.</p>
</li>
<li><p class="first">Los viewlets no guardan los datos (los portlets lo hacen)</p>
</li>
<li><p class="first">Los viewlets no tienen interfaz de usuario (los portlets lo hacen)</p>
</li>
</ul>
</div>
<div class="section" id="social-viewlet">
<h2>social-viewlet<a class="headerlink" href="#social-viewlet" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Vamos a añadir un enlace al sitio que utiliza la información que hemos recopilado utilizando el comportamiento social.</p>
<p>Registramos el viewlet en el archivo <code class="file docutils literal"><span class="pre">browser/configure.zcml</span></code>.</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;browser:viewlet</span>
  <span class="na">name=</span><span class="s">&quot;social&quot;</span>
  <span class="na">for=</span><span class="s">&quot;ploneconf.site.behaviors.social.ISocial&quot;</span>
  <span class="na">manager=</span><span class="s">&quot;plone.app.layout.viewlets.interfaces.IBelowContentTitle&quot;</span>
  <span class="na">class=</span><span class="s">&quot;.viewlets.SocialViewlet&quot;</span>
  <span class="na">layer=</span><span class="s">&quot;zope.interface.Interface&quot;</span>
  <span class="na">template=</span><span class="s">&quot;templates/social_viewlet.pt&quot;</span>
  <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
  <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Esto registra un viewlet llamado <code class="docutils literal"><span class="pre">social</span></code>. Es visible en todos los contenidos que implementa la interfaz <code class="docutils literal"><span class="pre">ISocial</span></code> de nuestro comportamiento. También es una buena práctica de obligar a la <a class="reference external" href="http://docs.plone.org/develop/plone/views/layers.html?highlight=browserlayer#introduction">BrowserLayer</a> <code class="docutils literal"><span class="pre">IPloneconfSiteLayer</span></code> de nuestra complemento por lo que sólo se muestra si nuestro complemento se instala en realidad.</p>
<p>The clase viewlet <code class="docutils literal"><span class="pre">SocialViewlet</span></code> es esperada en un archivo <code class="docutils literal"><span class="pre">browser/viewlets.py</span></code>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.layout.viewlets</span> <span class="kn">import</span> <span class="n">ViewletBase</span>

<span class="k">class</span> <span class="nc">SocialViewlet</span><span class="p">(</span><span class="n">ViewletBase</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</td></tr></table></div>
<p>Esta clase no hace nada excepto hacer que la plantilla asociada (Eso tenemos que escribir aún)</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Si utilizamos <code class="docutils literal"><span class="pre">grok</span></code> no necesitaríamos para registrar los viewlets en el <code class="docutils literal"><span class="pre">configure.zcml</span></code> pero si hay que hacerlo en Python. Nos gustaría añadir un archivo viewlets.py que contiene la clase viewlet.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">five</span> <span class="kn">import</span> <span class="n">grok</span>
<span class="kn">from</span> <span class="nn">plone.app.layout.viewlets</span> <span class="kn">import</span> <span class="n">interfaces</span> <span class="k">as</span> <span class="n">viewletIFs</span>
<span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">Interface</span>

<span class="k">class</span> <span class="nc">SocialViewlet</span><span class="p">(</span><span class="n">grok</span><span class="o">.</span><span class="n">Viewlet</span><span class="p">):</span>
    <span class="n">grok</span><span class="o">.</span><span class="n">viewletmanager</span><span class="p">(</span><span class="n">viewletIFs</span><span class="o">.</span><span class="n">IBelowContentTitle</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p class="last">Esto haría lo mismo que el código anterior utilizando el paradigma de grok de la convención sobre configuración. En la browser views la referencia se denomina vista, tenga en cuenta que en viewlets grok se llama viewlets (en ese caso <code class="docutils literal"><span class="pre">viewlet/lanyrd_link</span></code>).</p>
</div>
<p>Vamos a añadir la plantilla faltante <code class="file docutils literal"><span class="pre">templates/social_viewlet.pt</span></code>.</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;social-links&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span>
       <span class="na">class=</span><span class="s">&quot;lanyrd-link&quot;</span>
       <span class="na">tal:define=</span><span class="s">&quot;link view/lanyrd_link&quot;</span>
       <span class="na">tal:condition=</span><span class="s">&quot;link&quot;</span>
       <span class="na">tal:attributes=</span><span class="s">&quot;href link&quot;</span><span class="nt">&gt;</span>
         See this talk on Lanyrd!
    <span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Como se puede ver que esto no es un documento HTML válido. Eso no es necesario, porque no queremos una visión completa aquí, sólo un fragmento html.</p>
<p>Hay una sentencia TAL define, las consultas para <code class="docutils literal"><span class="pre">view/lanyrd_link</span></code>. Al igual que en la página de plantillas de la plantilla tiene acceso a su clase.</p>
<p>Tenemos que ampliar el Viewlet Social ahora para añadir el atributo que faltan:</p>
<div class="sidebar">
<p class="first sidebar-title">¿Por qué no acceder directamente contexto?</p>
<p>En este ejemplo, <code class="samp docutils literal"><span class="pre">ISocial(self.context)</span></code> devuelve el contexto directamente. Todavía es bueno utilizar este idioma por dos razones:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p class="first">Se deja en claro, que sólo queremos usar el aspecto iSocial del objeto</p>
</li>
<li><p class="first">Si decidimos utilizar una fábrica, por ejemplo, para almacenar nuestros atributos en una anotación, nosotros deberíamos <cite>not</cite> conseguir nuestro contexto, pero el adaptador.</p>
</li>
</ol>
</div></blockquote>
<p class="last">Por lo tanto, en este ejemplo, usted puede simplemente escribir <code class="docutils literal"><span class="pre">return</span> <span class="pre">self.context.lanyrd</span></code>.</p>
</div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.layout.viewlets</span> <span class="kn">import</span> <span class="n">ViewletBase</span>
<span class="hll"><span class="kn">from</span> <span class="nn">ploneconf.site.behaviors.social</span> <span class="kn">import</span> <span class="n">ISocial</span>
</span>
<span class="k">class</span> <span class="nc">SocialViewlet</span><span class="p">(</span><span class="n">ViewletBase</span><span class="p">):</span>

<span class="hll">    <span class="k">def</span> <span class="nf">lanyrd_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="n">adapted</span> <span class="o">=</span> <span class="n">ISocial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">adapted</span><span class="o">.</span><span class="n">lanyrd</span>
</span></pre></div>
</td></tr></table></div>
<p>Hasta ahora, hemos</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">registrar el viewlet al contenido que tiene la interfaz iSocial.</p>
</li>
<li><p class="first">adaptar el objeto a su comportamiento para ser capaz de acceder a los campos del comportamiento</p>
</li>
<li><p class="first">devolver el enlace</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="exercise-1">
<h2>Ejercicio 1<a class="headerlink" href="#exercise-1" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Registrar una viewlet &#8216;number_of_talks &#8221; en el pie de página que es visible sólo para los administradores (el permiso que busca es <code class="docutils literal"><span class="pre">cmf.ManagePortal</span></code>). Utilice sólo una plantilla (sin clase) para mostrar el número de talks ya enviadas. Sugerencia: Utilice Adquisición para conseguir el catálogo (Usted sabe, no debe hacer esto, pero hay un montón de código por ahí que lo hace...)</p>
<div class="toggle admonition">
<p class="first admonition-title">Solución</p>
<p>Registrar el viewlet en el archivo <code class="file docutils literal"><span class="pre">browser/configure.zcml</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">browser</span><span class="p">:</span><span class="n">viewlet</span>
  <span class="n">name</span><span class="o">=</span><span class="s">&quot;number_of_talks&quot;</span>
  <span class="k">for</span><span class="o">=</span><span class="s">&quot;*&quot;</span>
  <span class="n">manager</span><span class="o">=</span><span class="s">&quot;plone.app.layout.viewlets.interfaces.IPortalFooter&quot;</span>
  <span class="n">layer</span><span class="o">=</span><span class="s">&quot;zope.interface.Interface&quot;</span>
  <span class="n">template</span><span class="o">=</span><span class="s">&quot;templates/number_of_talks.pt&quot;</span>
  <span class="n">permission</span><span class="o">=</span><span class="s">&quot;cmf.ManagePortal&quot;</span>
  <span class="o">/&gt;</span>
</pre></div>
</div>
<p>Para el <code class="docutils literal"><span class="pre">for</span></code> y <code class="docutils literal"><span class="pre">layer</span></code> -parámetros <code class="docutils literal"><span class="pre">*</span></code> es la abreviatura de <code class="docutils literal"><span class="pre">zope.interface.Interface</span></code> y el mismo efecto que la omisión de ellos: El viewlet se mostrará para todos los tipos de páginas y para todos los sitios de Plone en su instancia Zope.</p>
<p>Agregar la plantilla <code class="file docutils literal"><span class="pre">browser/templates/number_of_talks.pt</span></code>:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;number_of_talks&quot;</span>
     <span class="na">tal:define=</span><span class="s">&quot;catalog python:context.portal_catalog;</span>
<span class="s">                 talks python:len(catalog(portal_type=&#39;talk&#39;));&quot;</span><span class="nt">&gt;</span>
    There are <span class="nt">&lt;span</span> <span class="na">tal:replace=</span><span class="s">&quot;talks&quot;</span> <span class="nt">/&gt;</span> talks.
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">python:context.portal_catalog</span></code> devolverá el catálogo a través de la adquisición. Tenga cuidado si usted desea utilizar de expresiones de rutas: <code class="docutils literal"><span class="pre">content/portal_catalog</span></code> llama el catálogo (y devuelve todos los cerebros). Es necesario para evitar esto usando <code class="docutils literal"><span class="pre">nocall:content/portal_catalog</span></code>.</p>
<p>Basándose en Adquisición es una mala idea. Sería mucho mejor utilizar la helper view <code class="docutils literal"><span class="pre">plone_tools</span></code> desde <code class="docutils literal"><span class="pre">plone/app/layout/globals/tools.py</span></code> para obtener el catálogo.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;number_of_talks&quot;</span>
     <span class="na">tal:define=</span><span class="s">&quot;catalog context/@@plone_tools/catalog;</span>
<span class="s">                 talks python:len(catalog(portal_type=&#39;talk&#39;));&quot;</span><span class="nt">&gt;</span>
    There are <span class="nt">&lt;span</span> <span class="na">tal:replace=</span><span class="s">&quot;talks&quot;</span> <span class="nt">/&gt;</span> talks.
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">context/&#64;&#64;plone_tools/catalog</span></code> atraviesa a la vista <code class="docutils literal"><span class="pre">plone_tools</span></code> y llama a su método <code class="docutils literal"><span class="pre">catalog</span></code>. En python que se vería así:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;number_of_talks&quot;</span>
     <span class="na">tal:define=</span><span class="s">&quot;catalog python:context.restrictedTraverse(&#39;plone_tools&#39;).catalog();</span>
<span class="s">                 talks python:len(catalog(portal_type=&#39;talk&#39;));&quot;</span><span class="nt">&gt;</span>
    There are <span class="nt">&lt;span</span> <span class="na">tal:replace=</span><span class="s">&quot;talks&quot;</span> <span class="nt">/&gt;</span> talks.
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p class="last">No es una buena práctica consultar el catálogo dentro de una plantilla, ya que incluso sea una lógica simple como esto, debería vivar en Python. Pero es muy poderoso si está depurando o necesita una solución rápida y sucia.</p>
</div>
</div>
<div class="section" id="exercise-2">
<h2>Ejercicio 2<a class="headerlink" href="#exercise-2" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Registrar la viewlet &#8216;days_to_conference&#8217; en la cabecera. Utilice una clase y una plantilla para mostrar el número de días hasta la conferencia. Usted consigue muchos puntos de bonificación si se muestra en un formato agradable (pensar &#8220;En 2 días&#8221; y &#8220;Último mes&#8221;) utilizando un javascript existentes o biblioteca python.</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The text and illustrations in this website are licensed by the Plone Foundation under a Creative Commons Attribution 4.0 International license.
      Actualizado por última vez en 09 de Marzo de 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.5a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>


</body>
</html>