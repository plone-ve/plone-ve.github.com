

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>18. Views - Parte III: Una lista de Charlas &mdash; Maestría en Plone, un entrenamiento para principiantes - 1.2.5a</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
        <link rel="author" title="Sobre este documento"
              href="about.html"/>
    <link rel="top" title="Maestría en Plone 1.2.5a documentation" href="index.html"/>
        <link rel="next" title="Registro de cambios" href="CHANGES.html"/>
        <link rel="prev" title="17. Views - Parte II: Una vista por defecto para la “charla”" href="views_2.html"/>
<script type="text/javascript" src="_static/plone.js"></script>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Maestría en Plone</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">Sobre &#8220;Maestría en Plone&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#upcoming-trainings">Próximos entrenamientos</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#previous-trainings">Entrenamientos previos</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#trainers">Entrenadores</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#using-the-documentation-for-a-training">Usando la documentación para un entrenamiento</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#contributing">Contribuyendo</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#license">Licencia</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introducción</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#who-are-you">¿Quien eres tu?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-do">¿Qué haremos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-will-we-not-do">¿Qué no haremos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-to-expect">¿Qué esperar?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#documentation">Documentación</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#further-reading">Lecturas recomendadas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Instalación y configuración</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-plone">Instalando Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hosting-plone">Alojando Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#production-deployment">Despliegue en ambientes de producción</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plone_training_config/instructions.html">3. Instalando Plone para el entrenamiento</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#installing-plone-without-vagrant">Instalando Plone sin Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-virtualbox">Instalar VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#install-and-configure-vagrant">Instalar y configurar Vagrant</a></li>
<li class="toctree-l2"><a class="reference internal" href="plone_training_config/instructions.html#what-vagrant-does">¿Qué hace Vagrant?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">4. La Anatomía de Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope2">Zope2</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#content-management-framework">Content Management Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-toolkit-zope3">Zope Toolkit / Zope3</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#zope-component-architecture-zca">Zope Component Architecture (ZCA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="anatomy.html#pyramid">Pyramid</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case.html">5. El caso de estudio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="case.html#background">Detalle</a></li>
<li class="toctree-l2"><a class="reference internal" href="case.html#requirements">Requerimientos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="features.html">6. Las características de Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="features.html#starting-and-stopping-plone">Iniciando y Deteniendo Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#users">Usuarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#configure-a-mailserver">Configurar un servidor de correo</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#walkthrough-of-the-ui">Tutorial de la interfaz de usuario</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-types">Tipos de Contenidos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#folders">Carpetas</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#collections">Colecciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#content-rules">Reglas de Contenido</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#history">Histórico</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#manage-members-and-groups">Administrar usuarios y grupos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#workflows">Flujos de trabajos</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#working-copy">Copia de trabajo</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html#placeful-workflows">Flujos de trabajo Placeful</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuring_customizing.html">7. Configurando y personalizando Plone a través de la Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#the-control-panel">El panel de control</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#portlets">Portlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#viewlets">Viewlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#zmi">ZMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring_customizing.html#summary">Resumen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">8. Extendiendo Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-technologies">Tecnologías de extensión</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#what-are-components-what-is-zcml">¿Cuáles son los componentes?, ¿Que es el ZCML?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addons.html">9. Extiende Plone con paquetes Complementos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addons.html#how-to-find-add-ons">¿Como buscar complementos?</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#some-notable-add-ons">Algunos complementos notables</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#installing-add-ons">Instalando complementos</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#ploneformgen">PloneFormGen</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#add-photogallery-with-collective-plonetruegallery">Agregar Galerías de fotos con collective.plonetruegallery</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#internationalization">Internacionalización</a></li>
<li class="toctree-l2"><a class="reference internal" href="addons.html#summary">Resumen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">10. Temas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theming.html#diazo-example">ejemplo Diazo</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#templating-example">ejemplo de Plantila</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#choosing-the-right-tool">Seleccionando la herramienta adecuada</a></li>
<li class="toctree-l2"><a class="reference internal" href="theming.html#want-to-really-learn-theming">¿Quieres aprender realmente tematización?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dexterity.html">11. Dexterity - Parte I: A través de la Web</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#what-is-a-content-type">¿Qué es un tipo de contenido?</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#the-makings-of-a-plone-content-type">Los elementos de un tipo de contenido Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#dexterity-and-archetypes-a-comparison">Dexterity y Archetypes - Una comparación</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#installation">Instalación</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#modifying-existing-types">Modificando tipos existentes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#creating-content-types-ttw">Creando tipos de contenidos a través de la Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#moving-content-types-into-code">Moviendo el tipo de contenido dentro del código fuente</a></li>
<li class="toctree-l2"><a class="reference internal" href="dexterity.html#exercises">Ejercicios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="buildout_1.html">12. Buildout - Parte I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#syntax">Sintaxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#recipes">Recetas</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#references">Referencias</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#a-real-life-example">Un ejemplo de la vida real</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#hello-mr-developer">¡Hola mr.developer!</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#extensible">Extensible</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildout_1.html#be-mcguyver">Sea un McGuyver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eggs1.html">13. Creando complementos para personalizar Plone</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#using-zopeskel-to-create-an-egg">Usando zopeskel para crear un paquete egg</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#inspecting-the-package">Inspeccione el paquete</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#including-the-egg-in-plone">Incluyendo el paquete egg en Plone</a></li>
<li class="toctree-l2"><a class="reference internal" href="eggs1.html#return-to-dexterity-moving-content-types-into-code">Volver Dexterity: para mover tipos de contenidos a código fuente</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_1.html">14. Views - Parte I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_1.html#a-simple-browser-view">Una simple browser view</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt.html">15. Zope Page Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#tal-and-tales">TAL y TALES</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#metal-and-macros">METAL y macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#accessing-plone-from-the-template">Accediendo a Plone desde la plantilla</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#what-we-missed">Lo que echamos de menos</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt.html#chameleon">Chameleon</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="zpt_2.html">16. Personalizar plantillas existentes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#newsitem-pt">El archivo newsitem.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#summary-view-pt">El archivo summary_view.pt</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#finding-the-right-template">Buscando la correcta plantilla</a></li>
<li class="toctree-l2"><a class="reference internal" href="zpt_2.html#skin-templates">Plantillas skins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views_2.html">17. Views - Parte II: Una vista por defecto para la &#8220;charla&#8221;</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#view-classes">Vista de clases</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#the-default-view">La vista por defecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_2.html#exercise">Ejercicio</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">18. Views - Parte III: Una lista de Charlas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-portal-catalog">Usando portal_catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="#brains-and-objects">Cerebros y objetos</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-the-catalog">Consultando el catálogo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">Ejercicios</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-template-for-the-listing">La plantilla para la lista</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-a-custom-view-as-default-view-on-an-object">Configuración de una vista personalizada como vista por defecto en un objeto</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-some-javascript-collective-js-datatables">Agregando un poco de Javascript (collective.js.datatables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Resumen</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CHANGES.html">Registro de cambios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#unreleased">1.2.5 (unreleased)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id1">1.2.4 (2014-10-03)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id2">1.2.3 (2014-07-11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id3">1.2.2 (2014-06-01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id4">1.2.1 (2014-05-30)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#id5">1.2 (2014-05-23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2013">1.1 (October 2013)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2012">1.0 (October, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2011">0.2 October 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="CHANGES.html#october-2009">0.1 (October 2009)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Mapa de ruta</a><ul>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#id1">1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="roadmap.html#todo">Todo</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Maestría en Plone</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>18. Views - Parte III: Una lista de Charlas</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="views-iii-a-talk-list">
<h1>18. Views - Parte III: Una lista de Charlas<a class="headerlink" href="#views-iii-a-talk-list" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">¡Obtén el código!</p>
<p>Obtén el código para este capítulo (<a class="reference internal" href="sneak.html"><em>Más información</em></a>) usando este comando en el directorio buildout:</p>
<div class="last highlight-bash"><div class="highlight"><pre>cp -R src/ploneconf.site_sneak/chapters/18_views_3/ src/ploneconf.site
</pre></div>
</div>
</div>
<p>Ahora no queremos proporcionar información sobre un elemento específico, sino en varios elementos. ¿Y ahora qué? No podemos mirar a varios elementos al mismo tiempo que el contexto.</p>
<div class="section" id="using-portal-catalog">
<h2>Usando portal_catalog<a class="headerlink" href="#using-portal-catalog" title="Permalink to this headline">¶</a></h2>
<p>Digamos que queremos mostrar una lista de todas las charlas que se presentaron durante la conferencia. Sólo podemos ir a la carpeta y seleccione un método de visualización que nos convenga. Pero ninguno lo hace porque queremos para mostrar al público objetivo en nuestro listado.</p>
<p>Así que tenemos que conseguir todas las charlas. Para ello utilizamos la vista de la clase Python para consultar en el catálogo las charlas.</p>
<p>El catálogo es como un motor de búsqueda por el contenido de nuestro sitio. Contiene información sobre todos los objetos, así como algunos de sus atributos como título, descripción, desde estado de flujo de trabajo, palabras clave que fueron etiquetadas, autor, tipo de contenido, su ruta en el sitio, etc. Sin embargo, no se mantiene el contenido de campos &#8220;pesado&#8221; como imágenes o archivos, campos texto enriquecidos y el campo que acabamos de definir nosotros mismos.</p>
<p>Es la forma más rápida de obtener el contenido que existe en el sitio y hacer algo con él. A partir de los resultados del catálogo podemos conseguir los mismos objetos, pero a menudo no lo necesita, pero sólo las propiedades que los resultados ya tienen.</p>
<p>El archivo <code class="docutils literal"><span class="pre">browser/configure.zcml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;browser:page</span>
   <span class="na">name=</span><span class="s">&quot;talklistview&quot;</span>
   <span class="na">for=</span><span class="s">&quot;*&quot;</span>
   <span class="na">layer=</span><span class="s">&quot;zope.interface.Interface&quot;</span>
   <span class="na">class=</span><span class="s">&quot;.views.TalkListView&quot;</span>
   <span class="na">template=</span><span class="s">&quot;templates/talklistview.pt&quot;</span>
   <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
   <span class="nt">/&gt;</span>
</pre></div>
</td></tr></table></div>
<p>El archivo <code class="docutils literal"><span class="pre">browser/views.py</span></code></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>
<span class="kn">from</span> <span class="nn">plone</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">plone.dexterity.browser.view</span> <span class="kn">import</span> <span class="n">DefaultView</span>


<span class="k">class</span> <span class="nc">DemoView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This does nothing so far</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">TalkView</span><span class="p">(</span><span class="n">DefaultView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The default view for talks</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">TalkListView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A list of talks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">talks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">portal_catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
        <span class="n">current_path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getPhysicalPath</span><span class="p">())</span>

        <span class="n">brains</span> <span class="o">=</span> <span class="n">portal_catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&quot;talk&quot;</span><span class="p">,</span>
                                <span class="n">path</span><span class="o">=</span><span class="n">current_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
            <span class="n">talk</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">Title</span><span class="p">,</span>
                <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">Description</span><span class="p">,</span>
                <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">getURL</span><span class="p">(),</span>
                <span class="s">&#39;audience&#39;</span><span class="p">:</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">talk</span><span class="o">.</span><span class="n">audience</span><span class="p">),</span>
                <span class="s">&#39;type_of_talk&#39;</span><span class="p">:</span> <span class="n">talk</span><span class="o">.</span><span class="n">type_of_talk</span><span class="p">,</span>
                <span class="s">&#39;speaker&#39;</span><span class="p">:</span> <span class="n">talk</span><span class="o">.</span><span class="n">speaker</span><span class="p">,</span>
                <span class="s">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">brain</span><span class="o">.</span><span class="n">UID</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</td></tr></table></div>
<p>Nosotros consultamos el catálogo para dos cosas:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">portal_type</span> <span class="pre">=</span> <span class="pre">&quot;talk&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">path</span> <span class="pre">=</span> <span class="pre">&quot;/&quot;.join(self.context.getPhysicalPath())</span></code></li>
</ul>
<p>Obtenemos la ruta del contexto actual para consultar sólo para los objetos en la ruta actual. De lo contrario íbamos a obtener todas las charlas en todo el sitio. Si nos trasladamos algunas charlas a una parte diferente del lugar (por ejemplo, un sub-conferencia de universidades con una lista especial charla) puede ser que no quiera ver así en nuestra lista.</p>
<p>Nosotros iteramos sobre la lista de resultados que el catálogo nos devuelve.</p>
<p>Creamos un diccionario que contiene toda la información que queremos mostrar en la plantilla. De esta manera no tiene que poner ninguna lógica compleja en la plantilla.</p>
</div>
<div class="section" id="brains-and-objects">
<h2>Cerebros y objetos<a class="headerlink" href="#brains-and-objects" title="Permalink to this headline">¶</a></h2>
<p>Los objetos normalmente no se cargan en la memoria, pero permanecen latentes en el base de datos ZODB. Despertar objetos hasta puede ser lento, especialmente si usted está despertando una gran cantidad de objetos. Afortunadamente nuestros tipos de contenidos no son especialmente pesados, ya que son:</p>
<ul class="simple">
<li><p class="first">objetos dexterity que son más ligeros que sus hermanos archetypes</p>
</li>
<li><p class="first">relativamente pocos, ya que no tenemos miles de charlas en nuestra conferencia</p>
</li>
</ul>
<p>Queremos mostrar al público objetivo, pero que los atributos de las charlas no está en el catálogo. Esto es por qué tenemos que llegar a los objetos mismos.</p>
<p>También podríamos agregar un nuevo índice al catálogo que agregará &#8216;audience&#8217; a las propiedades de los cerebros. Tenemos que ponderar los pros y contras:</p>
<ul class="simple">
<li><p class="first">charlas son importantes y por lo tanto más probable es que siempre este en memoria</p>
</li>
<li><p class="first">prevenir la inflamación del catálogo con índices</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>El código para agregar este índice se vería como el siguiente:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.indexer.decorator</span> <span class="kn">import</span> <span class="n">indexer</span>
<span class="kn">from</span> <span class="nn">ploneconf.site.talk</span> <span class="kn">import</span> <span class="n">ITalk</span>

<span class="nd">@indexer</span><span class="p">(</span><span class="n">ITalk</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">talk_audience</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
     <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">audience</span>
</pre></div>
</div>
<p>Tendríamos que registrar esta función factory como un adaptador llamado en el archivo <code class="docutils literal"><span class="pre">configure.zcml</span></code>. Suponiendo que haya puesto el código fuente anterior en un archivo llamado indexers.py</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;adapter</span> <span class="na">name=</span><span class="s">&quot;audience&quot;</span> <span class="na">factory=</span><span class="s">&quot;.indexers.talk_audience&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p class="last">Vamos a agregar algunos índices más adelante.</p>
</div>
<p>¿Por qué utilizar el catálogo en absoluto?, comprueba los permisos, y sólo devuelve las charlas que el usuario actual puede ver. Puede ser que sean privados u ocultos a usted, ya que son parte de una conferencia de super secreta para los desarrolladores del núcleo de Plone (¡no hay tal cosa!).</p>
<p>La mayoría de los objetos en Plone son como diccionarios, por lo que podían hacer <code class="docutils literal"><span class="pre">context.values()</span></code> para obtener todos sus contenidos.</p>
<p>Por razones históricas, algunos atributos de los cerebros y los objetos se escriben de manera diferente:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">title</span>
<span class="go">u&#39;Talk-submission is open!&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">brain</span><span class="o">.</span><span class="n">Title</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">brain</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span>
<span class="go">False</span>
</pre></div>
</div>
<p>¿Quién puede adivinar lo que <code class="docutils literal"><span class="pre">brain.title</span></code> volverán ya que el cerebro no tiene ese atributo?</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Respuesta: La Adquisición obtendrá el atributo de servidor principal más cercano. <code class="docutils literal"><span class="pre">brain.__parent__</span></code>  es <code class="docutils literal"><span class="pre">&lt;CatalogTool</span> <span class="pre">at</span> <span class="pre">/Plone/portal_catalog&gt;</span></code>. El atributo <code class="docutils literal"><span class="pre">title</span></code> del <code class="docutils literal"><span class="pre">portal_catalog</span></code> es &#8216;Indexado en todo el contenido en el sitio&#8217;.</p>
</div>
<p>La Adquisición puede ser nocivo. Los cerebros no tienen el atributo &#8216;getLayout&#8217; <code class="docutils literal"><span class="pre">brain.getLayout()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">brain</span><span class="o">.</span><span class="n">getLayout</span><span class="p">()</span>
<span class="go">&#39;folder_listing&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">getLayout</span><span class="p">()</span>
<span class="go">&#39;newsitem_view&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">brain</span><span class="o">.</span><span class="n">getLayout</span>
<span class="go">&lt;bound method PloneSite.getLayout of &lt;PloneSite at /Plone&gt;&gt;</span>
</pre></div>
</div>
<p>Lo mismo es cierto para los métodos:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">()</span>
<span class="go">&#39;http://localhost:8080/Plone/news/talk-submission-is-open&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brain</span><span class="o">.</span><span class="n">getURL</span><span class="p">()</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">brain</span><span class="o">.</span><span class="n">getPath</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">getPhysicalPath</span><span class="p">())</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="querying-the-catalog">
<h2>Consultando el catálogo<a class="headerlink" href="#querying-the-catalog" title="Permalink to this headline">¶</a></h2>
<p>Hay muchos <a class="reference external" href="http://docs.plone.org/develop/plone/searching_and_indexing/indexing.html">índices de catálogo</a> para consultar. He aquí algunos ejemplos:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">portal_catalog</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">portal_catalog</span><span class="p">(</span><span class="n">Subject</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;cats&#39;</span><span class="p">,</span> <span class="s">&#39;dogs&#39;</span><span class="p">))</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">portal_catalog</span><span class="p">(</span><span class="n">review_state</span><span class="o">=</span><span class="s">&#39;pending&#39;</span><span class="p">)</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>Llamando al catálogo sin parámetros devuelven todo el sitio:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">portal_catalog</span><span class="p">()</span>
<span class="go">[&lt;Products.ZCatalog.Catalog.mybrains object at 0x1085a11f0&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x1085a12c0&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x1085a1328&gt;, &lt;Products.ZCatalog.Catalog.mybrains object at 0x1085a13 ...</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://docs.plone.org/develop/plone/searching_and_indexing/query.html">http://docs.plone.org/develop/plone/searching_and_indexing/query.html</a></p>
</div>
</div>
<div class="section" id="exercises">
<h2>Ejercicios<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Ya que ahora saben cómo consultar el catálogo es el momento para un poco de ejercicio.</p>
<div class="section" id="exercise-1">
<h3>Ejercicio 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>Agregue un método <code class="docutils literal"><span class="pre">get_news</span></code> a <code class="docutils literal"><span class="pre">TalkListView</span></code> que devuelve una lista de los cerebros de todos los elementos de Noticias que se publican y ordenarlos en el orden de su publicación fecha.</p>
<div class="toggle admonition">
<p class="first admonition-title">Solución</p>
<div class="last highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_news</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">portal_catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">portal_catalog</span><span class="p">(</span>
        <span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;News Item&#39;</span><span class="p">,</span>
        <span class="n">review_state</span><span class="o">=</span><span class="s">&#39;published&#39;</span><span class="p">,</span>
        <span class="n">sort_on</span><span class="o">=</span><span class="s">&#39;effective&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="exercise-2">
<h3>Ejercicio 2<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Agregar un método que regresa todas las keynotes publicadas como objetos.</p>
<div class="toggle admonition">
<p class="first admonition-title">Solución</p>
<div class="last highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">keynotes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">portal_catalog</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
    <span class="n">brains</span> <span class="o">=</span> <span class="n">portal_catalog</span><span class="p">(</span>
        <span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;Talk&#39;</span><span class="p">,</span>
        <span class="n">review_state</span><span class="o">=</span><span class="s">&#39;published&#39;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
        <span class="c"># There is no catalog-index for type_of_talk so we must check</span>
        <span class="c"># the objects themselves.</span>
        <span class="n">talk</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">talk</span><span class="o">.</span><span class="n">type_of_talk</span> <span class="o">==</span> <span class="s">&#39;Keynote&#39;</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">talk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="the-template-for-the-listing">
<h2>La plantilla para la lista<a class="headerlink" href="#the-template-for-the-listing" title="Permalink to this headline">¶</a></h2>
<p>A continuación, crear una plantilla en la usa los resultados del método de las &#8216;charlas&#8217;.</p>
<p>Trate de mantener la lógica mayormente en Python. Esto es por dos razones:</p>
<dl class="docutils">
<dt>Legibilidad:</dt>
<dd><p class="first last">Es mucho más fácil de leer Python que complejas estructuras de TAL.</p>
</dd>
<dt>Velocidad:</dt>
<dd><p class="first last">El código Python es más rápido que el código ejecutado en las plantillas. También es fácil de añadir almacenamiento en caché a los métodos.</p>
</dd>
<dt>Don&#8217;t Repeat Yourself (DRY):</dt>
<dd><p class="first last">En Python se puede volver a utilizar métodos y refactorizar código fácilmente. Refactorizando TAL generalmente significa tener que hacer grandes cambios en la estructura HTML que se traduce en diffs incomprensible.</p>
</dd>
</dl>
<p>El esquema MVC no se aplica directamente a Plone pero míralo de esta manera:</p>
<dl class="docutils">
<dt>Modelo:</dt>
<dd><p class="first last">el objeto</p>
</dd>
<dt>Vista:</dt>
<dd><p class="first last">la plantilla</p>
</dd>
<dt>Controlador:</dt>
<dd><p class="first last">la vista</p>
</dd>
</dl>
<p>La vista y el controlador están muy mezclados en Plone. Especialmente cuando nos fijamos en algunos de los códigos más antiguos de Plone verás que la política de mantener la lógica en Python y representación en las plantillas no siempre se cumple.</p>
<p>¡Pero usted debe, no obstante, que lo haga! Usted va a terminar con más que suficiente lógica en las plantillas de todos modos.</p>
<p>Agregar esta sencilla tabla al archivo <code class="docutils literal"><span class="pre">templates/talklistview.pt</span></code>:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;listing&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Title
            <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Speaker
            <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Audience
            <span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>
               The 7 sins of plone-development
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                Philip Bauer
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                Advanced
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Después usted lo transforma dentro de una lista:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;listing&quot;</span> <span class="na">id=</span><span class="s">&quot;talks&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Title
            <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Speaker
            <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Audience
            <span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">tal:repeat=</span><span class="s">&quot;talk view/talks&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span>
                   <span class="na">tal:attributes=</span><span class="s">&quot;href talk/url;</span>
<span class="s">                                   title talk/description&quot;</span>
                   <span class="na">tal:content=</span><span class="s">&quot;talk/title&quot;</span><span class="nt">&gt;</span>
                   The 7 sins of plone-development
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">tal:content=</span><span class="s">&quot;talk/speaker&quot;</span><span class="nt">&gt;</span>
                Philip Bauer
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">tal:content=</span><span class="s">&quot;talk/audience&quot;</span><span class="nt">&gt;</span>
                Advanced
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">tal:condition=</span><span class="s">&quot;not:view/talks&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">3</span><span class="nt">&gt;</span>
                No talks so far :-(
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Hay algunas cosas que necesitan explicación:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">tal:repeat=&quot;talk</span> <span class="pre">view/talks&quot;</span></code></dt>
<dd><p class="first last">Este itera sobre la lista de diccionarios devueltos por la vista. La vista <code class="docutils literal"><span class="pre">view/talks</span></code> llama al método <code class="docutils literal"><span class="pre">talks</span></code> de nuestro vista y cada <code class="docutils literal"><span class="pre">talk</span></code> es a su vez regresa uno de los diccionarios que son devueltos por este método. Desde las expresiones de ruta TAL para la búsqueda de los valores en los diccionarios es la misma que los atributos de los objetos se puede escribir <code class="docutils literal"><span class="pre">talk/somekey</span></code> como pudimos <code class="docutils literal"><span class="pre">view/somemethod</span></code>. Práctico, pero a veces irritante ya de mirar la page template solos a menudo no tenemos forma de saber si algo es un atributo, un método o el valor de un diccionario. Sería una buena práctica para escribir <code class="docutils literal"><span class="pre">tal:repeat=&quot;talk</span> <span class="pre">python:view.talks()&quot;</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">tal:content=&quot;talk/speaker&quot;</span></code></dt>
<dd><p class="first last">&#8216;speaker&#8217; es una clave en el diccionario &#8216;talk&#8217;. También podríamos escribir <code class="docutils literal"><span class="pre">tal:content=&quot;python:talk['speaker']&quot;</span></code></p>
</dd>
<dt><code class="docutils literal"><span class="pre">tal:condition=&quot;not:view/talks&quot;</span></code></dt>
<dd><p class="first last">Esta es una alternativa en caso de no se devuelven las charlas. A continuación, devolver una lista vacía (¿recuerda <code class="docutils literal"><span class="pre">results</span> <span class="pre">=</span> <span class="pre">[]</span></code>?)</p>
</dd>
</dl>
<div class="section" id="exercise">
<h3>Ejercicio<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h3>
<p>Modificar la vista para solamente expresiones Python.</p>
<div class="toggle admonition">
<p class="first admonition-title">Solución</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;listing&quot;</span> <span class="na">id=</span><span class="s">&quot;talks&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Title
            <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Speaker
            <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>
                Audience
            <span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody</span> <span class="na">tal:define=</span><span class="s">&quot;talks python:view.talks()&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">tal:repeat=</span><span class="s">&quot;talk talks&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span>
                   <span class="na">tal:attributes=</span><span class="s">&quot;href python:talk[&#39;url&#39;];</span>
<span class="s">                                   title python:talk[&#39;description&#39;]&quot;</span>
                   <span class="na">tal:content=</span><span class="s">&quot;python:talk[&#39;title&#39;]&quot;</span><span class="nt">&gt;</span>
                   The 7 sins of plone-development
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">tal:content=</span><span class="s">&quot;python:talk[&#39;speaker&#39;]&quot;</span><span class="nt">&gt;</span>
                Philip Bauer
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">tal:content=</span><span class="s">&quot;python:talk[&#39;audience&#39;]&quot;</span><span class="nt">&gt;</span>
                Advanced
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">tal:condition=</span><span class="s">&quot;python:not talks&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">3</span><span class="nt">&gt;</span>
                No talks so far :-(
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
</td></tr></table></div>
<p class="last">Para seguir el principio &#8220;don&#8217;t repeat yourself&#8221; nosotros definimos <code class="docutils literal"><span class="pre">talks</span></code> vez de llamar al método dos veces.</p>
</div>
</div>
</div>
<div class="section" id="setting-a-custom-view-as-default-view-on-an-object">
<h2>Configuración de una vista personalizada como vista por defecto en un objeto<a class="headerlink" href="#setting-a-custom-view-as-default-view-on-an-object" title="Permalink to this headline">¶</a></h2>
<p>No queremos tener siempre que a anexar /&#64;&#64;talklistview a nuestra carpeta para obtener la vista. Hay una manera muy fácil de configurar la vista de la carpeta con el ZMI.</p>
<p>Si agregamos <code class="docutils literal"><span class="pre">/manage_propertiesForm</span></code> podemos establecer la propiedad &#8220;layout&#8221; para la vista <code class="docutils literal"><span class="pre">talklistview</span></code>.</p>
<p>Para hacer vistas configurables para que los editores pueden elegir entonces tenemos que registrar la vista para el tipo de contenido que nos ocupa, en que es FTI. Para activar si todas las carpetas tiene esta vista se añade un nuevo archivo <code class="docutils literal"><span class="pre">profiles/default/types/Folder.xml</span></code></p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;Folder&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;view_methods&quot;</span> <span class="na">purge=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;talklistview&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;alias</span> <span class="na">from=</span><span class="s">&quot;@@talklistview&quot;</span> <span class="na">to=</span><span class="s">&quot;talklistview&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Después de volver a aplicar el perfil typeinfo del complemento (o, simplemente, volver a instalarlo) el tipo de contenido &#8220;Carpeta&#8221; se amplía con nuestro método de vista adicional y aparece en la pantalla desplegable.</p>
<p>La opción <code class="docutils literal"><span class="pre">purge=&quot;False&quot;</span></code> anexa a la vista de los ya existentes en lugar de reemplazarlos.</p>
</div>
<div class="section" id="adding-some-javascript-collective-js-datatables">
<h2>Agregando un poco de Javascript (collective.js.datatables)<a class="headerlink" href="#adding-some-javascript-collective-js-datatables" title="Permalink to this headline">¶</a></h2>
<p>Aquí se utiliza una de las muchas agradables característica construida en Plone. La class=&#8221;listing&#8221; da la tabla un buen estilo y hace que la tabla se puede ordenar con un poco de Javascript.</p>
<p>Pero podríamos mejorar esa tabla aún más mediante el uso de una buena biblioteca Javascript llamada &#8220;datatables&#8221;. Incluso podría llegar a ser parte del core de Plone en algún momento.</p>
<p>Al igual que para muchas bibliotecas Javascript ya hacen esto y hay un paquete que sin embargo la integración con Plone para nosotros es: <code class="docutils literal"><span class="pre">collective.js.datatables</span></code>. Al igual que todos los paquetes Python usted lo puede encontrar en PYPI: <a class="reference external" href="http://pypi.python.org/pypi/collective.js.datatables">http://pypi.python.org/pypi/collective.js.datatables</a></p>
<p>Ya hemos añadido el complemento a nuestra buildout, sólo tienes que activarlo en nuestra plantilla.</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span>
      <span class="na">metal:use-macro=</span><span class="s">&quot;context/main_template/macros/master&quot;</span>
      <span class="na">i18n:domain=</span><span class="s">&quot;ploneconf.site&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="hll"><span class="nt">&lt;metal:head</span> <span class="na">fill-slot=</span><span class="s">&quot;javascript_head_slot&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="na">href=</span><span class="s">&quot;++resource++jquery.datatables/media/css/jquery.dataTables.css&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">
</span><span class="hll">    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;++resource++jquery.datatables.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="hll">    <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class="hll">        $(document).ready(function(){
</span><span class="hll">            var oTable = $(&#39;#talks&#39;).dataTable({
</span><span class="hll">            });
</span><span class="hll">        })
</span><span class="hll">    <span class="nt">&lt;/script&gt;</span>
</span><span class="hll"><span class="nt">&lt;/metal:head&gt;</span>
</span>
<span class="nt">&lt;metal:content-core</span> <span class="na">fill-slot=</span><span class="s">&quot;content-core&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;listing&quot;</span> <span class="na">id=</span><span class="s">&quot;talks&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th&gt;</span>
                    Title
                <span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>
                    Speaker
                <span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;</span>
                    Audience
                <span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">tal:repeat=</span><span class="s">&quot;talk view/talks&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;td&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span>
                       <span class="na">tal:attributes=</span><span class="s">&quot;href talk/url;</span>
<span class="s">                                       title talk/description&quot;</span>
                       <span class="na">tal:content=</span><span class="s">&quot;talk/title&quot;</span><span class="nt">&gt;</span>
                       The 7 sins of plone-development
                    <span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">tal:content=</span><span class="s">&quot;talk/speaker&quot;</span><span class="nt">&gt;</span>
                    Philip Bauer
                <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">tal:content=</span><span class="s">&quot;talk/audience&quot;</span><span class="nt">&gt;</span>
                    Advanced
                <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">tal:condition=</span><span class="s">&quot;not:view/talks&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">3</span><span class="nt">&gt;</span>
                    No talks so far :-(
                <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;/metal:content-core&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Nosotros no necesitamos la clase CSS <code class="docutils literal"><span class="pre">listing</span></code> nunca más, ya que podría entrar en conflicto con la biblioteca datatables (no es así, pero aún así ...).</p>
<p>La documentación de la biblioteca datatables está más allá de nuestro entrenamiento.</p>
<p>Utilizamos METAL de nuevo pero esta vez para llenar un slot diferente. El &#8220;javascript_head_slot&#8221; es parte de área &lt;head&gt; del HTML en Plone y se puede ampliar de esta manera. También podríamos simplemente poner el código fuente en línea, pero con HTML muy bien ordenado es una buena práctica.</p>
<p>Hagamos una prueba con la siguiente dirección URL: <a class="reference external" href="http://localhost:8080/Plone/talklistview">http://localhost:8080/Plone/talklistview</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Añadimos el archivo <code class="docutils literal"><span class="pre">jquery.datatables.js</span></code> directamente a la ranura HEAD del HTML sin utilizar un registro en la herramienta Plone JavaScript registry (portal_javascript). Al utilizar el registro podría permitir la fusión de los archivos js y almacenamiento en caché avanzado. Un perfil GenericSetup está incluido en el paquete collective.js.datatables.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Resumen<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Hemos creado un bonito listado, que se puede llamar en cualquier lugar en el sitio web.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="CHANGES.html" class="btn btn-neutral float-right" title="Registro de cambios"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="views_2.html" class="btn btn-neutral" title="17. Views - Parte II: Una vista por defecto para la “charla”"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The text and illustrations in this website are licensed by the Plone Foundation under a Creative Commons Attribution 4.0 International license.
      Actualizado por última vez en 08 de March de 2015.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.5a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .admonition-title").show();
        $(".toggle .admonition-title").click(function() {
            $(this).parent().children().not(".admonition-title").toggle(400);
            $(this).parent().children(".admonition-title").toggleClass("open");
        })
    });
</script>


</body>
</html>